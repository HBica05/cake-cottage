{% extends "base.html" %}
{% block content %}
<div class="row">
  <div class="col-lg-7 mb-3">
    {% if recipe.image %}
      <img class="img-fluid rounded" src="{{ recipe.image.url }}" alt="{{ recipe.title }}">
    {% endif %}
  </div>
  <div class="col-lg-5">
    <h1 class="mb-2">{{ recipe.title }}</h1>
    <p class="text-muted mb-1">Category: {{ recipe.category|title }}</p>
    <p class="text-muted">By {{ recipe.author.username }}</p>
    <p class="lead">{{ recipe.description }}</p>

    {% if user.is_authenticated %}
      <form method="post" action="{% url 'toggle_like' recipe.slug %}">
        {% csrf_token %}<button class="btn btn-primary">Like ({{ recipe.likes.count }})</button>
      </form>
    {% else %}
      <p><a href="{% url 'account_login' %}">Log in</a> to like or comment.</p>
    {% endif %}

    {% if user.is_authenticated and user == recipe.author %}
      <div class="mt-3">
        <a class="btn btn-outline-secondary" href="{% url 'recipe_edit' recipe.slug %}">Edit</a>
        <form method="post" action="{% url 'recipe_delete' recipe.slug %}" style="display:inline">
          {% csrf_token %}<button class="btn btn-outline-danger">Delete</button>
        </form>
      </div>
    {% endif %}
  </div>
</div>

<hr>
<h3>Ingredients</h3>
<p>{{ recipe.ingredients|linebreaks }}</p>

<h3>Instructions</h3>
<p>{{ recipe.instructions|linebreaks }}</p>

<hr>
<h3>Comments</h3>
<ul class="list-unstyled">
  {% for c in recipe.comments.all %}
    <li class="mb-2"><strong>{{ c.user }}</strong> â€“ {{ c.body }}</li>
  {% empty %}
    <li>No comments yet.</li>
  {% endfor %}
</ul>

{% if user.is_authenticated %}
  <h4 class="mt-3">Leave a comment</h4>
  <form method="post" action="{% url 'add_comment' recipe.slug %}">
    {% csrf_token %} {{ form.as_p }}
    <button class="btn btn-primary">Post</button>
  </form>
{% endif %}
{% endblock %}
